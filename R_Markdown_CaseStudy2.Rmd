---
title: "Google Data Analytics Case Study: How Can a Wellness Technology Company Play It Smart?"
author: "Author: YY"
output: html_document
date: "Date: 2024-03-17"
---
#### Programming language: R

```{r, echo=FALSE, out.width='60%', out.height='60%', fig.align='center'}
knitr::include_graphics("C:/R_Data/Case Study 2/img/img_1.webp")
```


# Content
##### Purpose of data analysis
##### About Dataset
##### Data preparation and processing
##### Data analysis
##### Data visualization and decision making




## Purpose of data analysis
##### Analyzing fitness data from smart device could help unlock new growth opportunities for the company. You have been asked to focus on one of products and analyze smart device data to gain insight into how consumers are using their smart devices. The insights you discover will then help guide marketing strategy for the company. The goal of the project is to analyze the comparison of user activity data and the duration of their sleep.

## About Dataset
##### This dataset generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring.

##### [At this link you can see the source data](https://www.kaggle.com/datasets/arashnic/fitbit)


## Data preparation and processing 
##### Please follow the step-by-step description of the code after the hashtag '#'
```{r}
# Read csv files and identify the data:

library("readr")
sleep_file_path <- ('C:/R_Data/Case Study 2/minuteSleep_merged.csv')
sleep_data <- read_csv(sleep_file_path)
# str(sleep_data)
# colnames(sleep_data)
head(sleep_data) # Checking the result

activity_file_path <- ('C:/R_Data/Case Study 2/dailyActivity_merged.csv')
activity_data <- read_csv(activity_file_path)
# str(activity_data)
# colnames(activity_data)
head(activity_data) # Checking the result
```

##### Data cleaning process
```{r}
# Run the libraries we will work with:
library(tidyverse)
library(reshape2)
```
##### In the columns 'sleep_data -> date' and 'activity_data -> ActivityDate' the time is indicated in different formats '3/13/2016 2:39:30 AM' and '3/25/2016' let's convert them into one format and name these columns the same for further mergers:

```{r}
# Changing date/time formats:
sleep_data$date <- as.Date(sleep_data$date, format = "%m/%d/%Y")
activity_data$ActivityDate <- as.Date(activity_data$ActivityDate, format = "%m/%d/%Y")

# Rename the "data" column to "ActivityDate":
sleep_data <- sleep_data %>%
  rename(ActivityDate = date)

# Checking the result:
head(sleep_data)

# Checking the result:
head(activity_data)

```
```{r}
# Check for missing values in the entire table:
any_na <- any(is.na(activity_data))

if (any_na) {
  print("Missing values present in activity_data")
} else {
  print("There are no missing values in activity_data")
}
indices <- which(is.na(activity_data), arr.ind = TRUE)
print(indices)

any_na <- any(is.na(sleep_data))
if (any_na) {
  print("Missing values present in sleep_data")
} else {
  print("There are no missing values in sleep_data")
}
indices <- which(is.na(sleep_data), arr.ind = TRUE)
print(indices)
```

```{r}

# Finding duplicate rows in activity_data for rows with combination "Id" and "ActivityDate":

# Create a logical indicator for rows with duplicates in the combination of "Id" and "ActivityDate":
duplicates_indicator <- duplicated(activity_data[, c("Id", "ActivityDate")]) | duplicated(activity_data[, c("Id", "ActivityDate")], fromLast = TRUE)

# Filter the table to show only rows with duplicates:
duplicates_rows <- activity_data[duplicates_indicator, ]

# Print rows with duplicates:
if (nrow(duplicates_rows) > 0) {
  print(duplicates_rows)
} else {
  print("There are no duplicates in Id and ActivityDate columns")
}

```
##### Data processing "sleep_data"

```{r}
# Create a new column 'SleepHours' in the sleep_data table and fill it with '1' values, since each row is equal to 1 minute of time:
sleep_data$SleepHours <- 1

# Removing unnecessary data, the "value" and "logId" columns:
sleep_data <- sleep_data %>% 
  select(-value, -logId)

# Group data by "Id" and "ActivityDate" columns and sum the "SleepHours" column in new data set "total_hours":
total_hours <- sleep_data %>%
  group_by(Id, ActivityDate) %>%
  summarize(SleepHours = sum(SleepHours, na.rm = TRUE))

# Divide the "SleepHours" column values by 60 to convert minutes to hours and round to decimal:
total_hours <- total_hours %>%
  mutate(SleepHours = SleepHours / 60) %>%
  mutate(SleepHours = round(SleepHours, digits = 1))

# Checking the result:
head(sleep_data)

# Checking the result:
head(total_hours)

```


##### Data processing 'activity_data':

```{r}

# Summarize the total activity in new data set 'new_activity_data', delete unnecessary data, convert minutes to hours and round to decimal:
new_activity_data <- activity_data %>%
  mutate(ActiveHours = VeryActiveMinutes + FairlyActiveMinutes + LightlyActiveMinutes)  %>% mutate(ActiveHours = ActiveHours / 60) %>%
  mutate(ActiveHours = round(ActiveHours, digits = 1))  %>% select(-TrackerDistance, -LoggedActivitiesDistance, -VeryActiveDistance, -LightActiveDistance, -ModeratelyActiveDistance, -LightlyActiveMinutes, -SedentaryActiveDistance, -VeryActiveMinutes, -FairlyActiveMinutes, -SedentaryMinutes)

# Checking the result:
head(new_activity_data)
```

## Data analysis
```{r}
# Joining tables 'new_activity_data' and 'total_hours' by "Id" and "ActivityDate" columns:
final_data <- inner_join(new_activity_data, total_hours, by = c("Id", "ActivityDate"))

# Checking the result:
str(final_data)
```

#### Determine Outliers:
##### Sleep less than 3 hours;
##### Other activity with a value less than or equal to 1;

##### If sleep duration was measured using a smart device, and the table contains values that indicate less than 3 hours of sleep. This is really strange data, because it is unlikely that a person could remain sane and at the same time have adequate sleep in such a short period of time.

##### In this case, it can be assumed that there may have been errors in data collection or the device was removed from the body. Typically, even with short periods of sleep, a person goes through several stages of sleep (for example: rapid eye movement (REM) and slow-wave sleep), which require a certain amount of time to pass through.

##### If there are such outliers in the table, they should likely be excluded from the analysis because they do not represent realistic data.

```{r}
library(dplyr)
# Removing rows where the value in the "SleepHours" column is less than or equal to 3 and 'TotalSteps' > 50, 'TotalDistance' > 1, 'Calories' > 100, 'ActiveHours' > 1:
final_data <- final_data %>%
  filter(SleepHours > 3 & TotalSteps > 50 & TotalDistance > 1 & Calories > 100 & ActiveHours > 1)

# Checking the result:
str(final_data)
```

##### Comparing the data after this step and the previous ones, we see that 30 rows of data were outside the boundaries of the real data. And that for the final analysis we have 169 rows of real data left. Despite the fact that at the beginning of the project we had ungrouped and uncleaned data in the amount of 198559 rows in 'activity_data'.

```{r}
# Write the data for analysis to a new file 'final_data':
write.csv(final_data, file = "C:/R_Data/Case Study 2/final_data.csv", row.names = FALSE)
head(final_data)
```

#### Сalculate the correlation of data according to Pearson.

##### The Pearson correlation coefficient measures the linear relationship between two continuous variables and can range from -1 to 1, where:
##### 1 means perfect positive linear correlation (as one variable increases, so does the other),
##### 0 means there is no linear correlation between the variables,
##### 1 means a perfect negative linear correlation (as one variable increases, the other decreases).

```{r}

# Select the columns that interest us and remove missing values for correction:
data_for_correlation <- final_data %>%
  select(TotalSteps, TotalDistance, Calories, ActiveHours, SleepHours) %>%
  na.omit() # Remove missing values

# Calculate the correlation:
correlation_matrix <- cor(data_for_correlation)

# Output the correlation matrix:
print(correlation_matrix)

```
#### The analysis of the correlation between activity levels and sleep indicates the following:
##### There is no strong relationship between sleep hours and activity indicators. All correlation coefficients are close to zero and negative, suggesting a very weak inverse relationship.
##### But we see a clear relationship between the correlation coefficient of Active Hours, Total Steps and Total Distance and also a less noticeable positive relationship between activity indicators and Сalories burned.


```{r}
# Calculate averages for variables of interest:
average_values <- final_data %>%
  select(TotalSteps, TotalDistance, Calories, ActiveHours, SleepHours) %>%
  summarise(
    AverageSteps = mean(TotalSteps, na.rm = TRUE),
    AverageDistance = mean(TotalDistance, na.rm = TRUE),
    AverageCalories = mean(Calories, na.rm = TRUE),
    AverageActiveHours = mean(ActiveHours, na.rm = TRUE),
    AverageSleepHours = mean(SleepHours, na.rm = TRUE)
  )

# Print the calculated average values:
print(average_values)
```

## Data visualization and decision making

#### Visualize the average values
```{r}
# Transform the data for visualization:
average_values_long <- average_values %>%
  tibble::rownames_to_column("Variable") %>%
  gather(key = "Metric", value = "Value", -Variable)

# Filter the data for the graph for other metrics:
low_values <- average_values_long %>%
  filter(!Metric %in% c("AverageSteps", "AverageCalories", "AverageDistance"))

# Create a graph for the remaining metrics:
ggplot(low_values, aes(x = Metric, y = Value, fill = Metric)) +
  geom_bar(stat = "identity", show.legend = FALSE) +
  theme_minimal() +
  labs(title = "Other Metrics: Distance, Active Hours, Sleep Hours", x = "Metric", y = "Average Value") +
  coord_flip()


```

##### From this visualization we see that according to our data, the average sleep duration corresponds to an 8-hour cycle and the average activity is slightly more than 4 hours per day.


#### Creating a heat map for the correlation matrix
```{r}
# Convert the correlation matrix into a "long" format for visualization using library(reshape2):
melted_correlation_matrix <- melt(correlation_matrix)

# Create a heat map
ggplot(melted_correlation_matrix, aes(x=Var1, y=Var2, fill=value)) +
  geom_tile() +
  scale_fill_gradient2(low = "blue", high = "red", mid = "white", 
                       midpoint = 0, limit = c(-1,1), space = "Lab", 
                       name="Correlation") +
  theme_minimal() +
  labs(title = "Heatmap of Correlation Matrix", x = "", y = "") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

##### According to the thermal matrix, we see between which parameters there is a positive relationship (indicated in red), there is also a negative relationship (indicated in blue), and a very weak or practically untraceable relationship (white or close to white).

#### Summing up the analysis based on the available data, we can draw the following conclusions:
##### 1. We found no relationship between physical activity and sleep duration. This may be caused by both the individual characteristics of the people who took part in the data collection, and the short period of time that these data cover. For a more detailed analysis, a larger data set should be studied.
##### 2. Activity indicators have a high correlation coefficient, which is natural. Following the correlation of these indicators, we can conclude that the data was processed correctly.
##### 3. The marketing department should focus more on advertising where there is a connection between activity and calorie loss. And try not to connect activity with sleep duration. Since the duration of sleep can be influenced by factors such as:
##### - night shift work;
#####  - mental state;
#####  - stress;
#####  - other individual characteristics.
